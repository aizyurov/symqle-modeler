<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="true" default-autowire="no">
    
    <bean id="generator" class="org.symqle.modeler.generator.Generator">
        <property name="codeWriter" ref="${symqle.modeler.code.writer}"/>
        <property name="modelReader" ref="metadataReader"/>
        <property name="transformers">
            <list>
                <ref bean="sieve"/>
                <bean class="org.symqle.modeler.metadata.TableTransformer"/>
                <bean class="org.symqle.modeler.metadata.ColumnTransformer"/>
                <bean class="org.symqle.modeler.metadata.ForeignKeyTransformer"/>
            </list>
        </property>
    </bean>
    
    <bean id="freeMarkerPlainKeysWriter" class="org.symqle.modeler.generator.CodeWriter">
        <property name="packageNames">
            <map>
                <entry key="model" value="${symqle.modeler.model.package}"/>
                <entry key="dto" value="${symqle.modeler.dto.package}"/>
                <entry key="dao" value="${symqle.modeler.dao.package}"/>
            </map>
        </property>
        <property name="outputDirectory" value="${symqle.modeler.generated.sources.dir}"/>
        <property name="samplesDirectory" value="${symqle.modeler.generated.samples.dir}"/>
        <property name="packageWriters">
            <list>
                <ref bean="freeMarkerPlainKeysTableWriter"/>
            </list>
        </property>
    </bean>

    <bean id="tableWriter" class="org.symqle.modeler.generator.RegularClassWriter">
        <property name="packageKey" value="model"/>
        <property name="suffix" value=""/>
        <property name="templateName" value="freemarker/Table.ftl"/>
        <property name="outputDirectory" value="${symqle.output.directory}"/>
    </bean>

    <bean id="generatedKeyWriter" class="org.symqle.modeler.generator.GeneratedKeyWriter">
        <property name="packageKey" value="dto"/>
        <property name="suffix" value="Id"/>
        <property name="templateName" value="freemarker/GeneratedKey.ftl"/>
        <property name="outputDirectory" value="${symqle.output.directory}"/>
    </bean>

    <bean id="dtoWriter" class="org.symqle.modeler.generator.RegularClassWriter">
        <property name="packageKey" value="dto"/>
        <property name="suffix" value="Dto"/>
        <property name="templateName" value="freemarker/Dto.ftl"/>
        <property name="outputDirectory" value="${symqle.samples.directory}"/>
    </bean>

    <bean id="selectorWriter" class="org.symqle.modeler.generator.RegularClassWriter">
        <property name="packageKey" value="dao"/>
        <property name="suffix" value="Selector"/>
        <property name="templateName" value="freemarker/Selector.ftl"/>
        <property name="outputDirectory" value="${symqle.samples.directory}"/>
    </bean>

    <bean id="smartSelectorWriter" class="org.symqle.modeler.generator.RegularClassWriter">
        <property name="packageKey" value="dao"/>
        <property name="suffix" value="SmartSelector"/>
        <property name="templateName" value="freemarker/SmartSelector.ftl"/>
        <property name="outputDirectory" value="${symqle.samples.directory}"/>
    </bean>

    <bean id="saverWriter" class="org.symqle.modeler.generator.SaverWriter">
        <property name="packageKey" value="dao"/>
        <property name="suffix" value="Crue"/>
        <property name="templateName" value="freemarker/Saver.ftl"/>
        <property name="outputDirectory" value="${symqle.samples.directory}"/>
    </bean>

    <bean id="metadataReader" class="org.symqle.modeler.metadata.MetadataReader">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.SingleConnectionDataSource">
        <property name="url" value="${symqle.modeler.jdbc.url}"/>
        <property name="driverClassName" value="${symqle.modeler.jdbc.driver}"/>
        <property name="username" value="${symqle.modeler.jdbc.user}"/>
        <property name="password" value="${symqle.modeler.jdbc.password}"/>
        <property name="suppressClose" value="false"/>
    </bean>
    
    <bean name="sieve" class="org.symqle.modeler.metadata.Sieve">
        <property name="tableFilters">
            <list>
                <bean class="org.symqle.modeler.transformer.RegexpFilter">
                    <property name="property" value="TABLE_TYPE"/>
                    <property name="pattern" value="ALIAS"/>
                    <property name="matchOutcome" value="DENY"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="propertyPlaceholderConfigurer"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>default.modeler.properties</value>
                <value>file:${user.home}/.symqle/modeler.properties</value>
            </list>
        </property>
        <property name="ignoreResourceNotFound" value="true"/>
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE"/>
    </bean>

</beans>
