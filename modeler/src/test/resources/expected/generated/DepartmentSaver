/* THIS IS SAMPLE CODE. SAVE AND EDIT AS NECESSARY */

package org.symqle.model;


import org.symqle.jdbc.Engine;
import org.symqle.jdbc.GeneratedKeys;
import org.symqle.jdbc.Option;
import org.symqle.sql.SetClauseList;
import org.symqle.model.DepartmentDto;
import org.symqle.model.Department;
import org.symqle.model.DepartmentId;
import org.symqle.model.EmployeeId;

import java.sql.SQLException;
import java.util.Arrays;
import java.util.List;

public class DepartmentSaver {

    private final Engine engine;
    private final Option[] options;

    public DepartmentSaver(final Engine engine, final Option[] options) {
        this.engine = engine;
        this.options = Arrays.copyOf(options, options.length);
    }

    public DepartmentId save(final DepartmentDto dto) throws SQLException {
        final Department table = new Department();
        final SetClauseList setList = table.deptName().set(dto.getDeptName())
                                .also(table.managerId().set(dto.getManagerId()))
                                .also(table.parentDept().set(dto.getParentDept()));
      final DepartmentId id = dto.getDeptId();
      if (id == null) {
          final GeneratedKeys<DepartmentId> generatedKeys = GeneratedKeys.create(DepartmentId.MAPPER);
          table.insert(setList).compileUpdate(generatedKeys, engine, options).execute();
          return generatedKeys.first();
      } else {
          final int affectedRows = table.update(setList).where(table.deptId().eq(id)).execute(engine, options);
          return affectedRows == 1 ? id : null;
      }
    }

    public boolean delete(final DepartmentId id) throws SQLException {
        final Department table = new Department();
        return 1 == table.delete().where(table.deptId().eq(id)).execute(engine, options);
    }

    public DepartmentDto getById(final DepartmentId id) throws SQLException {
        final Department table = new Department();
        List<DepartmentDto> list = new DepartmentSelect(table).where(table.deptId().eq(id)).list(engine, options);
        return list.isEmpty() ? null : list.get(0);
    }

}


